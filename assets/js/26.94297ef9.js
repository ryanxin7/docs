(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{431:function(s,t,a){"use strict";a.r(t);var _=a(27),v=Object(_.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"存储引擎介绍与企业案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储引擎介绍与企业案例"}},[s._v("#")]),s._v(" 存储引擎介绍与企业案例")]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#_1-前情回顾案例补充"}},[s._v("1. 前情回顾案例补充")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-1-索引应用规范"}},[s._v("1.1 索引应用规范")])]),a("li",[a("a",{attrs:{href:"#_1-2-不走索引的情况"}},[s._v("1.2 不走索引的情况")])])])]),a("li",[a("a",{attrs:{href:"#_2-存储引擎简介"}},[s._v("2. 存储引擎简介")]),a("ul",[a("li",[a("a",{attrs:{href:"#_2-1-存储引擎的查看"}},[s._v("2.1 存储引擎的查看")])]),a("li",[a("a",{attrs:{href:"#_2-2-存储引擎的修改"}},[s._v("2.2 存储引擎的修改")])]),a("li",[a("a",{attrs:{href:"#_2-3-企业真实碎片处理案例"}},[s._v("2.3 企业真实碎片处理案例")])])])]),a("li",[a("a",{attrs:{href:"#_3-企业真实案例更换存储引擎"}},[s._v("3. 企业真实案例更换存储引擎")]),a("ul",[a("li",[a("a",{attrs:{href:"#_3-1-zabbix-监控系统架构整改"}},[s._v("3.1   Zabbix  监控系统架构整改")])]),a("li",[a("a",{attrs:{href:"#_3-2-存储引擎的替换"}},[s._v("3.2 存储引擎的替换")])])])]),a("li",[a("a",{attrs:{href:"#_4-innodb-存储引擎核心特性说明"}},[s._v("4. InnoDB 存储引擎核心特性说明")])])])]),a("p"),s._v(" "),a("h2",{attrs:{id:"_1-前情回顾案例补充"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-前情回顾案例补充"}},[s._v("#")]),s._v(" 1. 前情回顾案例补充")]),s._v(" "),a("p",[a("strong",[s._v("explain (desc) 使用场景")])]),s._v(" "),a("p",[s._v("相关问题：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("你做过哪些优化?")])]),s._v(" "),a("li",[a("p",[s._v("你用过什么优化工具? "),a("strong",[s._v("explain")])])]),s._v(" "),a("li",[a("p",[s._v("你对索引这块怎么优化的?")]),s._v(" "),a("br")])]),s._v(" "),a("p",[a("strong",[s._v("题目意思: 我们公司业务慢,请你从数据库的角度分析原因")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("mysql出现性能问题,有两种情况:")])])]),s._v(" "),a("br"),s._v(" "),a("p",[s._v("第一种情况：应急性的慢：突然夯住  "),a("strong",[s._v("突然慢")])]),s._v(" "),a("p",[s._v("应急情况:数据库卡了,资源耗尽")]),s._v(" "),a("p",[a("strong",[s._v("处理过程:")])]),s._v(" "),a("ol",[a("li",[a("p",[a("code",[s._v("show processlist;")]),s._v(" （把当前会话所做的操作列出来） 获取到导致数据库卡住的语句")])]),s._v(" "),a("li",[a("p",[s._v("使用 "),a("code",[s._v("explain")]),s._v(" 分析SQL的执行计划,可能有没有走索引的,索引的类型情况。")])]),s._v(" "),a("li",[a("p",[s._v("建索引,改语句")])])]),s._v(" "),a("p",[s._v("第二种情况：一段时间慢(持续性的):"),a("strong",[s._v("每天都慢")]),s._v(" 9-11点")]),s._v(" "),a("p",[a("strong",[s._v("处理过程:")])]),s._v(" "),a("ol",[a("li",[s._v("记录慢日志 "),a("code",[s._v("slowlog")]),s._v(",分析"),a("code",[s._v("slowlog")])]),s._v(" "),a("li",[s._v("explain 分析SQL的执行计划,有没有走索引,索引的类型情况")]),s._v(" "),a("li",[s._v("建索引,改语句")])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"_1-1-索引应用规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-索引应用规范"}},[s._v("#")]),s._v(" 1.1 索引应用规范")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("建立索引的原则（DBA运维规范）")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("建表必须要有主键,一般是无关列,自增长")])]),s._v(" "),a("li",[a("p",[s._v("经常做为 "),a("code",[s._v("where")]),s._v(" 条件列 "),a("code",[s._v("order by")]),s._v(" "),a("code",[s._v("group by")]),s._v(" "),a("code",[s._v("join on")]),s._v(", "),a("code",[s._v("distinct")]),s._v(" 的条件")])]),s._v(" "),a("li",[a("p",[s._v("最好使用唯一值多的列作为联合索引前导列,其他的按照联合索引优化细节来做")])]),s._v(" "),a("li",[a("p",[s._v("列值长度较长的索引列,我们建议使用前缀索引.")])]),s._v(" "),a("li",[a("p",[s._v("降低索引条目,一方面不要创建没用索引,不常使用的索引清理,"),a("code",[s._v("percona")]),s._v(" "),a("code",[s._v("toolkit")])])]),s._v(" "),a("li",[a("p",[s._v("索引维护要避开业务繁忙期")])]),s._v(" "),a("li",[a("p",[s._v("小表不建索引")])])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("p",[s._v("使用 "),a("strong",[s._v("SQLyog")]),s._v(" 工具自动找出"),a("strong",[s._v("使用率不高的索引")])]),s._v(" "),a("img",{staticStyle:{zoom:"90%"},attrs:{src:"\\img\\dba05-1.png",alt:"dba05-1"}}),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("p",[a("br"),a("br")]),s._v(" "),a("h3",{attrs:{id:"_1-2-不走索引的情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-不走索引的情况"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1.2")]),s._v(" 不走索引的情况")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("不走索引的情况（开发规范）")]),s._v(" "),a("ul",[a("li",[s._v("没有查询条件，或者查询条件没有建立索引")])]),s._v(" "),a("p",[a("code",[s._v("select * from city;")])]),s._v(" "),a("p",[a("code",[s._v("select * from city where 1=1;")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("查询结果集是原表中的大部分数据，应该是25％以上。")])]),s._v(" "),a("li",[a("p",[s._v("索引本身失效，统计数据不真实")])])]),s._v(" "),a("p",[a("strong",[s._v("面试题: 同一个语句突然变慢?")])]),s._v(" "),a("p",[s._v("可能是因为统计信息过旧,导致的索引失效。")]),s._v(" "),a("ul",[a("li",[s._v("查询条件使用函数在索引列上，或者对索引列进行运算，运算包括("),a("code",[s._v("+，-，*，/，!")]),s._v(" 等)")])]),s._v(" "),a("p",[a("code",[s._v("mysql> desc select * from city where id-99=1;")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("隐式转换导致索引失效.")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("! = ，not in")]),s._v(" 不走索引（辅助索引）")])]),s._v(" "),a("li",[a("p",[s._v('like "%aa"` 百分号在最前面不走')])]),s._v(" "),a("li",[a("p",[s._v("联合索引")])])])]),s._v(" "),a("h2",{attrs:{id:"_2-存储引擎简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-存储引擎简介"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2. 存储引擎简介")])]),s._v(" "),a("br"),s._v(" "),a("p",[s._v("相当于Linux文件系统，只不过比文件系统强大")]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("存储引擎功能")])]),s._v(" "),a("ul",[a("li",[s._v("数据读写")]),s._v(" "),a("li",[s._v("数据安全和一致性")]),s._v(" "),a("li",[s._v("提高性能")]),s._v(" "),a("li",[s._v("热备份")]),s._v(" "),a("li",[s._v("自动故障恢复")]),s._v(" "),a("li",[s._v("高可用方面支持")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" engies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--查看存储引擎支持种类")]),s._v("\nCSV        \nMRG_MYISAM    \nMyISAM      \nBLACKHOLE     \nPERFORMANCE_SCHEMA\nMEMORY      \nARCHIVE      \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v("      \nFEDERATED  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("br"),s._v(" "),a("br"),s._v(" "),a("img",{staticStyle:{zoom:"90%"},attrs:{src:"\\img\\dba05-2.png",alt:"dba05-2"}}),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("笔试题")]),s._v("："),a("strong",[s._v("例举你了解的存储引擎")])]),s._v(" "),a("p",[a("strong",[s._v("答：InnoDB（新版本） ,MyISAM（老版本） ,MEMORY, CSV")])]),s._v(" "),a("br"),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("Mysql 5.7 默认的存储引擎:InnoDB")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("PerconaDB:默认是XtraDB")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("MariaDB:默认是InnoDB")])])])]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("插件式 第三方的存储引擎:")])]),s._v(" "),a("ul",[a("li",[s._v("RocksDB")]),s._v(" "),a("li",[s._v("MyRocks")]),s._v(" "),a("li",[s._v("TokuDB")])]),s._v(" "),a("p",[a("strong",[s._v("区别")]),s._v("：压缩比较高,数据的插入性能高.其他功能和 InnoDB 没差。")]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"_2-1-存储引擎的查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-存储引擎的查看"}},[s._v("#")]),s._v(" 2.1 存储引擎的查看")]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("查看存储引擎设置")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v(" \nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" engines"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--查看支持的存储引擎")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@default_storage_engine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("修改默认存储引擎")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/my.cnf   --修改配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("default_storage_engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("InnoDB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("查看表存储引擎状态")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v(" \nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n \nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'CountryLanguage'")]),s._v("\\G\n \nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" table_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("table_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" information_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" table_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sys'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'information_schema'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'performance_schema'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("br"),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"_2-2-存储引擎的修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-存储引擎的修改"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.2 存储引擎的修改")])]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("修改存储引擎为innodb")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v(" \nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("innodb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("br"),a("br")]),s._v(" "),a("p",[a("strong",[s._v("整理碎片")])]),s._v(" "),a("p",[s._v("在执行删除操作后原来占用的空间不会被立即释放掉会产生碎片，就需要通过命令进行碎片整理。")]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("有两种方法：")])]),s._v(" "),a("ol",[a("li",[a("code",[s._v("mysql> alter table t111 engine=innodb; innodb")]),s._v(" 命令 再执行一遍更改存储引擎命令 对业务影响小。")]),s._v(" "),a("li",[s._v("把原表导入 把表"),a("code",[s._v("drop")]),s._v("掉在重新导入回来 干净 但有风险。")])]),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"_2-3-企业真实碎片处理案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-企业真实碎片处理案例"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.3 企业真实碎片处理案例")])]),s._v(" "),a("p",[a("br"),a("strong",[s._v("环境:")]),s._v(" centos7.4,MySQL 5.7.20,InnoDB存储引擎")]),s._v(" "),a("p",[a("strong",[s._v("业务特点")]),s._v("：数据量级较大,经常需要按月删除历史数据.")]),s._v(" "),a("p",[a("strong",[s._v("问题:")]),s._v(" 磁盘空间占用很大,不释放")]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("处理方法:")])]),s._v(" "),a("p",[a("br"),a("strong",[s._v("以前:")]),s._v(" 将数据逻辑导出,手工 "),a("code",[s._v("truncate")]),s._v(" 表,然后导入进去。")]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("现在:")])]),s._v(" "),a("p",[s._v("对表进行按月进行分表("),a("strong",[s._v("partition,中间件")]),s._v(")。")]),s._v(" "),a("p",[s._v("业务替换为 "),a("strong",[s._v("truncate")]),s._v(" 方式。")]),s._v(" "),a("p",[s._v("定期进行碎片整理。")]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("批量替换 Zabbix 100 多张存储引擎 "),a("code",[s._v("innodb")]),s._v(" 的表为 "),a("code",[s._v("tokudb")]),s._v("引擎")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" zabbix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tokudb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 改一张表的命令")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" concat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alter table "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("table_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("table_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" engine=tokudb;"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" information_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" table_schema"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zabbix'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--使用拼接语句")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("br"),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h2",{attrs:{id:"_3-企业真实案例更换存储引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-企业真实案例更换存储引擎"}},[s._v("#")]),s._v(" 3. 企业真实案例更换存储引擎")]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"_3-1-zabbix-监控系统架构整改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-zabbix-监控系统架构整改"}},[s._v("#")]),s._v(" 3.1   Zabbix  监控系统架构整改")]),s._v(" "),a("p",[a("strong",[s._v("环境:")]),s._v(" zabbix 3.2  mariaDB 5.5 centos 7.3")]),s._v(" "),a("p",[a("strong",[s._v("现象 :")]),s._v(" zabbix卡的要死 , 每隔3-4个月,都要重新搭建一遍 zabbix,存储空间经常爆满.")]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("分析得出问题 :")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Zabbix 版本")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("数据库版本")])])]),s._v(" "),a("li",[a("p",[s._v("Zabbix数据库500G,全部存在一个文件里")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("优化建议:")])]),s._v(" "),a("p",[s._v("1.数据库版本升级到mariaDB最新版本,Zabbix升级更高版本")]),s._v(" "),a("p",[s._v("2.存储引擎改为 "),a("strong",[s._v("tokudb")])]),s._v(" "),a("p",[s._v("3.监控数据按月份进行切割(二次开发Zabbix 数据保留机制功能重写,数据库分表)")]),s._v(" "),a("p",[s._v("4.关闭binlog和双1")]),s._v(" "),a("p",[s._v("5.参数调整")]),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("优化结果")]),s._v(": 解决卡顿问题，监控状态良好")]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("p",[a("strong",[s._v("解决思路 ?")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("原生态支持 TokuDB,另外经过测试环境,"),a("strong",[s._v("10版本要比5.5 版本性能 高 2-3倍")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("TokuDB:insert 数据比 Innodb 快的多，数据压缩比要 Innodb 高")])])]),s._v(" "),a("li",[a("p",[s._v("监控数据按月份进行切割,为了能够truncate每个分区表,立即释放空间")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("关闭 binlog  减少无关日志的记录。")])])]),s._v(" "),a("li",[a("p",[s._v("参数调整  安全性参数关闭,提高性能。")])])]),s._v(" "),a("br"),s._v(" "),a("br"),s._v(" "),a("h3",{attrs:{id:"_3-2-存储引擎的替换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-存储引擎的替换"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.2 存储引擎的替换")])]),s._v(" "),a("p",[a("strong",[s._v("环境:")]),s._v(" centos 5.8 ,MySQL 5.0版本,MyISAM存储引擎,网站业务(LNMP),数据量50G左右")]),s._v(" "),a("p",[a("strong",[s._v("现象问题:")]),s._v(" 业务压力大的时候,非常卡;经历过宕机,会有部分数据丢失.")]),s._v(" "),a("p",[a("strong",[s._v("问题分析:")])]),s._v(" "),a("p",[s._v("1.MyISAM存储引擎表级锁,在高并发时,会有很高锁等待")]),s._v(" "),a("p",[s._v("2.MyISAM存储引擎不支持事务,在断电时,会有可能丢失数据")]),s._v(" "),a("p",[a("strong",[s._v("实际问题：")])]),s._v(" "),a("p",[s._v("1.监控锁的情况:有很多的表锁等待")]),s._v(" "),a("p",[s._v("2.存储引擎查看:所有表默认是MyISAM")]),s._v(" "),a("p",[a("strong",[s._v("解决方案:")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("升级MySQL 5.6.10版本")])]),s._v(" "),a("li",[a("p",[s._v("迁移所有表到新环境")])]),s._v(" "),a("li",[a("p",[s._v("开启双1安全参数")])])]),s._v(" "),a("h2",{attrs:{id:"_4-innodb-存储引擎核心特性说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-innodb-存储引擎核心特性说明"}},[s._v("#")]),s._v(" "),a("strong",[s._v("4. InnoDB 存储引擎核心特性说明")])]),s._v(" "),a("br"),s._v(" "),a("img",{staticStyle:{zoom:"90%"},attrs:{src:"\\img\\dba05-3.png",alt:"dba05-3"}}),s._v(" "),a("ol",[a("li",[s._v("支持事务")]),s._v(" "),a("li",[s._v("行级锁定")]),s._v(" "),a("li",[s._v("MVCC   并发控制")]),s._v(" "),a("li",[s._v("外键")]),s._v(" "),a("li",[s._v("ACSR自动故障恢复")]),s._v(" "),a("li",[s._v("热备 复制方面提供 (多线程,GTID,MTS)")])])])}),[],!1,null,null,null);t.default=v.exports}}]);